## 🧩 User Story 1 - 快速下一詞建議 (優先順序：P1)

### 使用者故事

作為一名 IELTS 寫作學習者，
我希望在輸入一句話的最後停頓時，系統能根據上下文預測出最可能的下一個自然詞彙，並附上可學習的例句、困惑度 (PPL) 以及 IELTS 寫作考官角度下的「Cohesion & Coherence」評分指標，
以幫助我學習地道、連貫且高分的寫作風格。

---

### 功能擴充說明

#### 1️⃣ PPL 與 IELTS Cohesion & Coherence 對應顯示

每個候選詞的例句須附帶：

* **困惑度 (Perplexity, PPL)**
* **對應的 IELTS Cohesion & Coherence Band 評分**（依句子流暢度與語篇銜接特徵自動映射）
* **IELTS 考官角度摘要描述**（以 Band 標準表為依據）

| PPL 範圍 |     對應 Band    | IELTS Examiner 解釋摘要      |
| :----: | :------------: | :----------------------- |
|  0–20  |   **Band 9**   | 句意流暢、銜接自然、連貫度極高。幾乎無語篇瑕疵。 |
|  21–40 |   **Band 8**   | 結構清晰、銜接順暢、僅偶有輕微不自然。      |
|  41–60 |   **Band 7**   | 句法連貫但略顯機械，部分連接詞或指代使用不精確。 |
|  61–80 |   **Band 6**   | 有整體邏輯但語篇銜接偶有失衡或重複。       |
|   >80  | **Band 5 或以下** | 結構鬆散、句與句間缺乏自然銜接或過度機械。    |

> 💡 **說明**：PPL–Band 對應模型由 IELTS 考官語料與大型學習者語料標註校正，並**每季度自動重新校準**以確保評分準確度。

---

#### 2️⃣ 使用者自定詞彙輸入

* 系統將即時計算該詞的, 並輸出於畫面：

  * 條件機率 P(wₙ | context)；
  * 例句困惑度 (PPL)；
  * 對應的 IELTS Band（依上表映射）；
* 若該詞與原候選詞之一匹配，系統會標註「✅ 系統推薦詞」。

**驗收依據：**
當使用者輸入自訂詞時，結果的 PPL 與 Band 評估方式須與系統內建候選詞相同，保證一致性。

> 系統預設使用最後 20 個詞作為上下文，以平衡準確性與效能。

---

#### 3️⃣ 重新生成例句 (Band 控制模式)

* 使用者可針對任一候選詞的例句點擊「🔄 重新生成」按鈕。
* 系統根據選定 Band (5/6/7/8/9) 生成一組**語意相同但語法層級、詞彙密度與連貫性不同**的版本。
* 例句生成必須遵循下列原則：

  1. **語意一致性 (Semantic similarity ≥ 0.9)**；
  2. **句長 ≤ 25 詞**；
  3. **句法與詞彙符合指定 Band 標準（見下表）**；
  4. **由 Consistency Manager 確保版本穩定且可重現。**

---

#### 4️⃣ Consistency Manager 模組規格

| 模組名稱                    | 說明                                             | 主要功能                                                              |
| :---------------------- | :--------------------------------------------- | :---------------------------------------------------------------- |
| **Consistency Manager** | 輸出穩定性控制                                        | 實作 **Self-Consistency** 與 **top-k / top-p 採樣**，確保重生例句在隨機採樣下的語義一致。 |
| **控制變數**                | temperature, top-k, top-p, self-consistency 次數 | 影響重生成過程的隨機性與重現性。                                                  |
| **驗證機制**                | semantic similarity (≥0.9)                     | 用以確認重新生成之例句語義與原句一致。                                               |

> 每次生成執行三輪 Self-Consistency 採樣，以維持語義穩定性。

---

#### 5️⃣ IELTS Writing Band 對應標準

|  Band | Coherence & Cohesion                                                                  | Lexical Resource                                          | Grammatical Range & Accuracy                           |
| :---: | :------------------------------------------------------------------------------------ | :-------------------------------------------------------- | :----------------------------------------------------- |
| **9** | The message can be **followed effortlessly**; cohesion **rarely attracts attention**. | Full flexibility, precise and natural vocabulary control. | Fully flexible and accurate; minimal errors.           |
| **8** | Information and ideas are **logically sequenced**, cohesion **well managed**.         | Fluent, flexible use of advanced vocabulary.              | Mostly error-free, high syntactic control.             |
| **7** | Logical structure, minor lapses in cohesion.                                          | Adequate range, some inaccuracy or overuse.               | Frequent error-free sentences, few grammatical errors. |
| **6** | Generally coherent but some **mechanical cohesion**.                                  | Adequate but limited vocabulary, occasional repetition.   | Mix of simple and complex forms, moderate accuracy.    |
| **5** | Organisation not wholly logical, cohesion often inaccurate.                           | Simple vocabulary, frequent repetition.                   | Frequent grammatical errors, limited control.          |

---

### ✳️ Consistency System — 強化版規格 (擴充自 Consistency Manager)

#### 📘 1. 跨 Band 一致性 (Inter-Band Consistency)

* 不同 Band (5–9) 生成版本必須維持**語義主幹一致 (similarity ≥ 0.9)**。
* 保存 Band 向量嵌入以檢測語義對齊，若差異超過閾值則標註 `⚠️ Band Drift` 並重新生成。

#### 🔁 2. 多次生成一致性 (Intra-Band Consistency)

* 同一 Band 多次 re-generate 結果需通過多輪語義平均檢驗：

  * 最近三次生成的語意平均相似度 ≥ 0.92。
  * 若低於閾值自動再生並調整採樣參數。

#### 🔄 3. 跨模組一致性 (Cross-Module Consistency)

* Validation Engine 與 Next-Word Prediction 共用同一 Consistency Manager：

  * 相同採樣參數 (temperature, top-k, top-p)。
  * Self-Consistency 次數 3。
  * semantic similarity 閾值 0.9。
* 兩模組生成結果皆通過統一「語義完整性測試」。

#### 📊 4. 一致性評分輸出 (Consistency Score)

* 每次生成輸出 `Consistency Score (0–100)`：

  * 依語義相似度、詞彙變異度、句法穩定性計算。
  * 顯示於例句旁：`Consistency: 94 (Stable)`。
  * 若分數 <85，自動提示「可再生以提升一致性」。

#### 🧠 5. 自動回溯比對機制 (Semantic Traceback)

* 保留最近五次生成結果並自動比對：

  * 任意結果相似度 <0.9 → 標記「不一致」。
  * 若三次以上不一致 → 觸發再生。
  * 支援手動差異檢視 (詞彙與句法結構 highlight)。

---

## ✳️ User Story 2 - 精確搭配驗證 (Validation)

### 使用者故事

作為使用者，
我希望輸入一個完整的搭配詞組，
系統能依據語料庫統計與 IELTS Writing 的 **Lexical Resource** 標準，
評估該搭配的慣用性與正確性，並提供對應例句，
以便我了解該片語是否「地道、常用」或需要改進。

---

### 🧩 模組依據與功能說明

| 模組名稱                    | 說明              | 主要功能                                                                                                                                |
| :---------------------- | :-------------- | :---------------------------------------------------------------------------------------------------------------------------------- |
| **Validation Engine**   | 搭配自然度與語言精確度評估模組 | 使用 **聯合機率 P(w₁..wₙ)** 衡量片語整體出現頻率，並以 **互資訊 (Mutual Information, MI)** 量化詞之間的搭配強度。依據結果生成可靠度分數、例句與對應的 **IELTS Lexical Resource Band**。 |
| **Consistency Manager** | 生成穩定性控制         | 與 Next-Word Prediction 模組共用一致性邏輯 (Self-Consistency 3 次，semantic similarity ≥ 0.9)。                                                  |

---

### ⚙️ Validation Engine 評估依據（必須）

1. **聯合機率 P(w₁..wₙ)**

   * 衡量片語整體的自然出現頻率（越高表示越常見、自然）。
   * 語料庫每半年更新一次並保留歷史版本以供比對。

2. **互資訊 (Mutual Information, MI)**

   * 衡量詞間的搭配強度（越高代表母語者常見的固定搭配）。
   * MI 高通常對應 **Band 8–9 Lexical Resource** 級別。

3. **Lexical Band Mapping**
   系統根據 (P, MI) 計算平均自然度指數 (L_score)，以 MI 70% / P 30% 加權，對應 IELTS Lexical Resource 評級表。
